angular.module("phoneApp",["ionic","DelegateEvents"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("forum",{"abstract":!0,url:"/forum"}).state("forum.index",{url:"/index.htm",templateUrl:"home/tp/index.html",controller:"tDefault"}).state("forum.start",{url:"/start.htm",templateUrl:"home/tp/start.html",controller:"tStart"}).state("forum.entry",{url:"/entry.htm",templateUrl:"entry/tp/entry.html",controller:"entryCtrl"}).state("forum.login",{url:"/login.htm",templateUrl:"entry/tp/login.html",controller:"loginCtrl"}).state("forum.loginForget",{url:"/login/forget.htm",templateUrl:"entry/tp/login_forget_password.html",controller:"loginForgetCtrl"}).state("forum.loginReset",{url:"/login/reset/:phone",templateUrl:"entry/tp/login_reset_password.html",controller:"loginResetCtrl"}).state("forum.registerCreate",{url:"/register/create.htm",templateUrl:"entry/tp/register_create_data.html",controller:"registerCreateCtrl"}).state("forum.registerAccount",{url:"/register/account.htm",templateUrl:"entry/tp/register_set_account.html",controller:"registerAccountCtrl"}).state("forum.registerVcode",{url:"/register/vcode/:phone",templateUrl:"entry/tp/register_vcode.html",controller:"registerVcodeCtrl"}).state("forum.registerDone",{url:"/register/done.htm",templateUrl:"entry/tp/register_done.html",controller:"registerDoneCtrl"}).state("forum.registerColumn",{url:"/register/column.htm",templateUrl:"entry/tp/register_take_column.html",controller:"registerColumnCtrl"}).state("forum.registerPeople",{url:"/register/people.htm",templateUrl:"entry/tp/register_focus_people.html",controller:"registerFocusCtrl"}).state("forum.find",{url:"/find.htm",templateUrl:"forum/tp/find.html",controller:"tFindIndex"}).state("forum.like",{url:"/like.htm",templateUrl:"forum/tp/like.html",controller:"tFindLike"}).state("forum.photo-edit",{url:"/photo/edit.htm",templateUrl:"forum/tp/photo.html",controller:"tPhotoEdit"}).state("forum.photo-title",{url:"/photo/title.htm",templateUrl:"forum/tp/photo_title.html",controller:"tPhotoTitle"}).state("forum.photo-cate",{url:"/photo/cate-{id}.htm",templateUrl:"forum/tp/photo_cate.html",controller:"tPhotoCate"}).state("forum.club-hot",{url:"/club/hot.htm",templateUrl:"forum/tp/club_hot.html",controller:"tClubHot"}).state("forum.club-list",{url:"/club/list.htm",templateUrl:"forum/tp/club_list.html",controller:"tClubList"}).state("forum.club-detail",{url:"/club/detail-{id}.htm",templateUrl:"forum/tp/club_detail.html",controller:"tClubDetail"}).state("forum.club-ranking",{url:"/club/ranking-{id}.htm",templateUrl:"forum/tp/club_ranking.html",controller:"tClubRanking"}).state("forum.activity-list",{url:"/activity/list.htm",templateUrl:"forum/tp/activity_list.html",controller:"tActivityList"}).state("forum.activity-detail",{url:"/activity/detail-{type}-{id}.htm",templateUrl:"forum/tp/activity_detail.html",controller:"tActivityDetail"}).state("forum.subject-list",{url:"/subject/list.htm",templateUrl:"forum/tp/subject_list.html",controller:"tSubjectList"}).state("forum.subject-detail",{url:"/subject/detail-{id}.htm",templateUrl:"forum/tp/subject_detail.html",controller:"tSubjectDetail"}).state("forum.cate",{url:"/cate/list-{id}.htm",templateUrl:"forum/tp/cate_list.html",controller:"tCateList"}).state("forum.detail",{url:"/thread-{id}.htm",templateUrl:"forum/tp/article_detail.html",controller:"tArticleDetail"}).state("forum.comment-list",{url:"/comment/list-{id}.htm",templateUrl:"forum/tp/comment_list.html",controller:"tCommentList"}).state("forum.search",{url:"/search/index",templateUrl:"forum/tp/search.html",controller:"tSearchIndex"}).state("forum.search-result",{url:"/search/result?keyword",templateUrl:"forum/tp/search-result.html",controller:"tSearchResult"}).state("forum.chat",{url:"/chat-{uid}.htm",resolve:{isCheck:function(){return!0}},templateUrl:"forum/tp/chat.html",controller:"tMsgChat"}).state("forum.msg-index",{url:"/msg/index.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/index.html",controller:"tMsgIndex"}).state("forum.msg-notice",{url:"/msg/notice.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/notice.html",controller:"tMsgNotice"}).state("forum.msg-comment",{url:"/msg/comment.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/comment.html",controller:"tMsgComment"}).state("forum.msg-praise",{url:"/msg/praise.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/praise.html",controller:"tMsgPraise"}).state("forum.msg-search",{url:"/msg/search.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/search.html",controller:"tMsgSearch"}).state("forum.msg-talk",{url:"/msg/talk.htm",resolve:{isCheck:function(){return!0}},templateUrl:"msg/tp/talk.html",controller:"tMsgTalk"}).state("forum.user-index",{url:"/user/index.htm",templateUrl:"user/tp/index.html",controller:"tUserIndex"}).state("forum.user-other-index",{url:"/user/index-{uid}.htm",templateUrl:"user/tp/user_index.html",controller:"tUserOtherIndex"}).state("forum.user-about",{url:"/user/about.htm",templateUrl:"user/tp/about.html",controller:"tUserAbout"}).state("forum.user-feedback",{url:"/user/feedback.htm",templateUrl:"user/tp/feedback.html",controller:"tUserFeedback"}).state("forum.user-level",{url:"/user/level.htm",templateUrl:"user/tp/level.html",controller:"tUserLevel"}).state("forum.user-cate",{url:"/user/cate.htm",templateUrl:"user/tp/cate-{uid}.html",controller:"tUserCate"}).state("forum.user-article",{url:"/user/article-{uid}.htm",templateUrl:"user/tp/article.html",controller:"tUserArticle"}).state("forum.user-fans",{url:"/user/fans-{uid}.htm",templateUrl:"user/tp/fans.html",controller:"tUserFans"}).state("forum.user-attention",{url:"/user/attention-{uid}.htm",templateUrl:"user/tp/attention.html",controller:"tUserAttention"}).state("forum.user-club",{url:"/user/club-{uid}.htm",templateUrl:"user/tp/club.html",controller:"tUserClub"}).state("forum.userData",{url:"/user/{id}-data.htm",templateUrl:"user/tp/personal_data.html",controller:"userDataCtrl"}).state("forum.user-set",{url:"/user/set.htm",templateUrl:"user/tp/set.html",controller:"tUserSet"}).state("forum.user-set-password",{url:"/user/set/password.htm",templateUrl:"user/tp/set_password.html",controller:"tUserSetPassword"}).state("forum.user-set-bind",{url:"/user/set/bind.htm",templateUrl:"user/tp/set_bind.html",controller:"tUserSetBind"});var o=localStorage.getItem("PHONEAPP_START");t.otherwise("/forum/start.htm")}]),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/footer_bar.html",'<ion-footer-bar>\n    <footer class="mod_footer">\n        <a ng-class="{current : footerTab == 1}" page-jump="none" data-router="forum.index">\n            首页\n        </a>\n        <a ng-class="{current : footerTab == 2}" page-jump="none" data-router="forum.find">\n            发现\n        </a>\n        <p add-photo ng-class="{current : footerTab == 3}"></p>\n        <a ng-class="{current : footerTab == 4}" page-jump="none" data-router="forum.msg-index">\n            消息\n        </a>\n        <a ng-class="{current : footerTab == 5}" page-jump="none" data-router="forum.user-index">\n            我\n        </a>\n    </footer>\n</ion-footer-bar>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_bar.html",'<ion-header-bar class="mod_header" ng-class="{transparent:isTransparent}" ng-style="HeaderBg" align-title="center">\n	<div class="buttons">\n		<button page-back class="back_button"></button>\n	</div>\n	\n    <h1 class="title" ng-bind-html="Page.Title"></h1>\n\n	<div class="buttons buttons-right" ng-if="Page.RightText">\n		<button class="right_button" ng-click="Page.RightFun()">{{Page.RightText}}</button>\n	</div>\n\n    <div class="buttons buttons-right" ng-if="Page.Next">\n        <button class="right_button" page-jump data-router="{{Page.SiteUrl.router}}" data-options="{{Page.SiteUrl.options}}">{{Page.Next}}</button>\n    </div>\n</ion-header-bar>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_opacity.html",'<header class="js_op_header mod_header_opacity">\n    <ul>\n        <li></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n    <ul class="js_op_change this_op">\n        <li page-back></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/job_popup.html",'<div class="choose_post" ngd-click="chooseJob($event)" selector="li">\n	<ul>\n		<li>\n			<input ng-checked="tmpJob == \'园长\'" name="job" type="radio">\n			<label>园长</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'保教主任\'" name="job" type="radio">\n			<label>保教主任</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'教师\'" name="job" type="radio">\n			<label>教师</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'其他\'" name="job" type="radio">\n			<label>其他</label>\n		</li>\n	</ul>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/location_data.html",'<div class="choose_location" ngd-click="chooseLocation($event)" selector="li">\n	<div class="select_box">\n		<ul>\n			<li ng-class="{current:v.Id == inputVal.city.Id}" data-city="{{v}}" ng-repeat="(k, v) in cityList track by $index">{{v.Name}}</li>\n		</ul>\n	</div>\n	<div class="select_box">\n		<ul>\n			<li ng-class="{current:v.Id == inputVal.village.Id}" data-village="{{v}}" ng-repeat="(k, v) in villageList track by $index">{{v.Name}}</li>\n		</ul>\n	</div>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/location_popup.html",'<div class="choose_location" ngd-click="chooseLocation($event)" selector="li">\n	<ion-scroll class="select_box">\n		<ul>\n			<li ng-class="{current:v.Id == inputVal.city.Id}" data-city="{{v}}" ng-repeat="(k, v) in cityList track by $index">{{v.Name}}</li>\n		</ul>\n	</ion-scroll>\n	<ion-scroll class="select_box">\n		<ul>\n			<li ng-class="{current:v.Id == inputVal.village.Id}" data-village="{{v}}" ng-repeat="(k, v) in villageList track by $index">{{v.Name}}</li>\n		</ul>\n	</ion-scroll>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/mod_loading.html",'<ion-spinner icon="ios"></ion-spinner>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/no_network.html",'<div ng-if="noNetwork" class="no-network"> <i class="icon-no-network"></i>\n	网络不给力，刷新页面重试\n	<button ng-click="refreshPage();" class="button button-block button-positive">刷新页面</button>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/no_results.html",'<div ng-if="noResults" class="no-results">\n    <i ng-if="hasGlass" class="icon-search"></i>\n    {{noResultsText}}\n</div>\n')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/search_header.html",'<header class="mod_header_search">\n    <div>\n        <input ng-model="keyword" type="text" value="" placeholder="搜索内容/标签/圈子/用户" />\n        <button ng-click="toSearch()"></button>\n    </div>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/user_login.html",'<div class="user_login_pop">\n    <div class="this_cancel" ng-click="closeLogin()">取消</div>\n\n    <dl>\n        <dt></dt>\n        <dd>\n            <ul>\n                <li><input ng-model="tInput.phone" type="number" type="number" placeholder="输入手机号" /></li>\n                <li><input ng-model="tInput.password" type="password" placeholder="输入密码" /></li>\n                <li class="this_login" ng-click="toLogin()">登录</li>\n                <li class="this_link">\n                    <div page-jump data-router="forum.loginForget">找回密码</div>\n                    <div>注册账号</div>\n                </li>\n            </ul>\n        </dd>\n    </dl>\n</div>')}])}(),angular.module("phoneApp").factory("cachePool",function(){var e=function(e){if(!e)return null;var t,o=localStorage.getItem("phoneApp_"+e);try{t=JSON.parse(o)}catch(n){}return t?t:null},t=864e5,o=function(o,n,r){if(o&&n){var l=e(o)||{};l.value=n||void 0,l.expired=r?Date.now()+t*r:void 0,localStorage.setItem("phoneApp_"+o,JSON.stringify(l))}},n=function(t){var o,n=e(t);return!n||n.expired&&n.expired<=Date.now()?null:o=n.value},r=function(t,o){if(t){var n=e(t);return n?void(o&&n[o]?(n[o]=void 0,localStorage.setItem("phoneApp_"+t,JSON.stringify(n))):localStorage.removeItem("phoneApp_"+t)):void localStorage.removeItem("phoneApp_"+t)}};return{push:o,pull:n,remove:r}}),angular.module("phoneApp").factory("ENV",["$location",function(e){var t=navigator.userAgent.toLowerCase(),o={apiSocket:"http://m.tjoys.net/api/",isHybrid:!1,isWeixin:!1,isApple:!1,isAndroid:!1,appVersion:"1.0.1"};if(isHybridCreatePhoneApp&&(o.isHybrid=!0),o.isHybrid&&/android/.test(t)&&(o.isAndroid=!0),o.isHybrid&&/iphone|ipad|ipod/.test(t)&&(o.isApple=!0,document.getElementById("js_view").className="is_ios"),/micromessenger/.test(t)&&(o.isWeixin=!0),o.isHybrid){var n=e.$$absUrl;o.apiSocket=n.replace(/www\/.*/gi,"www")+o.apiSocket}return o}]),angular.module("phoneApp").filter("ellipsis",function(){return function(e,t){return e&&t>0&&e.length>t?e.substring(0,t-2)+"…":e}}),angular.module("phoneApp").filter("specDate",["$filter",function(e){return function(t){var o=Date.now()-t,n="刚刚",r=36e5;return o>24*r?n=e("date")(t,"yyyy/MM/dd"):o>r&&(n=Math.floor(o/r)+"小时前"),n}}]),angular.module("phoneApp").filter("formatScore",function(){return function(e){return 10*Math.floor(e/.5)}}),angular.module("phoneApp").config(["$provide","$httpProvider",function(e,t){e.factory("httpInterceptor",["$q","ENV",function(e,t){var o={request:function(t){t.url;return t||e.when(t)},requestError:function(t){return e.reject(t)},response:function(t){return t||e.when(t)},responseError:function(t){return e.reject(t)}};return o}]),t.interceptors.push("httpInterceptor")}]),angular.module("phoneApp").factory("widget",["$http","$cacheFactory","$rootScope","$compile","$timeout","$location","$ionicLoading","$ionicBackdrop","$ionicHistory","$ionicScrollDelegate","cachePool","ENV",function(e,t,o,n,r,l,i,a,c,s,u,p){var m=null,d=t("dataPool"),h={msgToast:function(e,t){var l=angular.element(document.querySelector(".notifier"));if(!l.length){var i=n('<div class="notifier" ng-click="notification=null" ng-show="notification"><span>{{notification}}</span></div>');angular.element(document.getElementsByTagName("body")[0]).append(i(o))}r(function(){o.notification=e},0),r.cancel(m),m=r(function(){o.notification=""},t||2e3)},cacheData:function(e,t){if(!angular.isString(e))return!1;var o=d.get(e);return t?void d.put(e,t):o?o:!1},safeApply:function(e,t){e&&t&&(e.$$phase||e.$root&&e.$root.$$phase?t():e.$apply(t))},stickyTopScroll:function(e,t,o,n){if(e&&o&&o.length&&n&&n.getScrollPosition()){var r,l,i,a,c=n.getScrollPosition().top;if(void 0===e.stickyContent){var s=t('<h2 class="sticker" ng-show="stickyContent != null">{{stickyContent}}</h2>');a=s(e),a.css({position:"absolute",width:"100%"}),angular.element(n.getScrollView().__container).append(a),n.__sticker=a}else a=n.__sticker;for(var u=0,p=o.length;p>u;u++){if(r=o[u],0===u&&(l=r.clientHeight),!(c>=r.offsetTop)){a.hasClass("ng-hide")||(c>=r.offsetTop-l?a.css("top",r.offsetTop-l-c+"px"):a.css("top",0));break}i=r}i&&e.stickyContent!==i.innerHTML?(a.css("top",0),safeApply(e,function(){e.stickyContent=i.innerHTML})):i||safeApply(e,function(){e.stickyContent=null})}},ajaxRequest:function(t){if(t){var o=t.data||{},n={Header:{UserId:"",Auth:""}},r=u.pull("UserInfo");if(r&&(n.Header.UserId=r.UserId,n.Header.Auth=r.Auth),o=angular.extend({},o,n),t.showPage){var l=t.scope;if(l.Deploy.isLoading)return;if(l.Deploy.isLoading=!0,l.Deploy.pageIndex++,l.Deploy.pageTotal&&l.Deploy.pageIndex*l.Deploy.pageSize-l.Deploy.pageTotal>l.Deploy.pageSize)return void(l.Deploy.isMore=!1);angular.extend(o,{PageIndex:l.Deploy.pageIndex,PageSize:l.Deploy.pageSize})}var a={success:function(){},error:function(){},showPage:!1,showLoading:!0,isLogin:!1},c={method:"POST",url:p.apiSocket+t.url||"",data:o,timeout:15e3},s=function(){a.showLoading&&i.hide()};for(var m in t)a[m]=t[m];a.showLoading&&(!a.showPage||a.showPage&&a.PageIndex<2)&&i.show({templateUrl:"common/directives/mod_loading.html"}),e(c).success(function(e){e&&"function"==typeof a.success&&a.success(e),s()}).error(function(e){"function"==typeof a.error?a.error(e):msgToast("请检查你的网络"),s(),a.showPage&&(l.Deploy.isLoading=!1)})}},showStatusBar:function(){function e(){StatusBar.show()}p.isHybrid&&document.addEventListener("deviceready",e,!1)},clearHistory:function(){c.clearHistory()},changeOpacity:function(){var e=s.$getByHandle("mainScroll").getScrollPosition().top,t=0;t=e>30?((e-30)/100).toFixed(1):0,t>1&&(t=1),angular.element(document.querySelector(".js_op_header .js_op_change")).css({opacity:t})}},g=null;o.$on("$locationChangeStart",function(){angular.element(document.getElementById("shareBtnCtrl")).css("display","none"),g&&(g.close(),g=null)});return h}]),angular.module("phoneApp").directive("checkUser",["$state","$rootScope","cachePool","widget",function(e,t,o,n){return{controller:function(){t.$on("$stateChangeStart",function(e,t,n,r,l){var i=0,a=o.pull("UserInfo")||"";return a&&(i=a.UserId),console.log(i),t.resolve&&t.resolve.isCheck()&&!i?(console.log(1231231),void(window.location.href="/#/entry/login.htm")):void 0})}}}]),angular.module("phoneApp").directive("collectionCtrl",["$timeout","Util","DataCachePool",function(e,t,o){return{restrict:"A",link:function(t,n,r){var l=JSON.parse(r.item?r.item:!1);if(l){var i=o.pull("COLLECTION_GOODS")||[],a=-1,c=function(e){return void 0===e?r.index?t.isCollect[r.index]:t.isCollect:void(r.index?t.isCollect[r.index]=e:t.isCollect=e)};e(function(){for(var e=0;e<i.length;e++)if(i[e].InnerId===l.InnerId){a=e,c(!0);break}},0),n.on("click",function(t){if(c())e(function(){c(!1)},100),i.splice(a,1),o.push("COLLECTION_GOODS",i);else{e(function(){c(!0)},100);var n={Id:l.ProductID,InnerId:l.InnerId,Title:l.Name,ImgUrl:l.Picture};i.unshift(n),o.push("COLLECTION_GOODS",i)}})}}}}]),angular.module("phoneApp").directive("contenteditable",function(){return{require:"?ngModel",link:function(e,t,o,n){n&&(t.on("focus",function(e){var t=angular.element(e.target);"备注要求"===t.text()&&t.text("")}),t.on("blur",function(e){var t=angular.element(e.target);""===t.text()&&t.text("备注要求")}),t.on("input",function(){var o=t.html();o=o.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,""),e.$apply(function(){n.$setViewValue(o),n.$render()})}),t.on("keyup",function(t){return 13===t.keyCode?(console.log(e.remark),!1):void 0}),n.$render=function(){t.html(n.$viewValue)},n.$render())}}}),function(){var e=document.documentElement,t=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector,o=function(e,o){return t?t.call(e,o):e.tagName.toLowerCase()===o},n=function(t,n,r){for(r||(r=e);t&&t!=r&&r.contains(t);){if(o(t,n))return t;t=t.parentNode}return null},r={};e.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))});var l=/^\s*?{.+}\s*?$/;angular.forEach("Event Click Dblclick Mousedown Mouseup Mouseover Mouseout Mousemove Mouseenter Mouseleave".split(" "),function(e){var t="ngd"+e;r[t]=["$parse",function(o){return function(r,i,a){function c(e,t){var l=o(e);i.on(t,function(e){var o,a=e.target;(o=n(a,"string"==typeof s?s:s[t],i[0]))&&(e.delegationTarget=o,l(angular.element(o).scope(),{$event:e,$params:[].slice.call(arguments,1)}),r.$$phase||r.$apply())})}var s=a.selector,u="Event"==e?a.eventName||"click":e.toLowerCase(),p=a[t];s.match(l)&&(s=r.$eval(s)),p.match(l)?(p=r.$eval(p),angular.forEach(p,c)):c(p,u)}}]}),angular.module("DelegateEvents",[]).directive(r)}(),angular.module("phoneApp").directive("falls",["$parse","$rootScope",function(e,t){return{restrict:"E",replace:!0,transclude:!0,template:'<ul class="mod_list_falls ng-transclude"></ul>',controller:["$scope","$element","$attrs",function(e,o,n){t.setFalls=function(e){if(e)var t=angular.element(document.querySelector(e));else var t=o;var n=t.find("li");if(0!=n.length){var r={x:10,y:10},l=t.find("li")[0].offsetWidth,i=l/200;angular.forEach(n,function(e,t){angular.element(e).find("img").eq(0).css({height:e.dataset.y*i+"px"});var o=e.offsetHeight;r.x<=r.y?(e.style.cssText="left:0;top:"+r.x+"px",r.x=r.x+10+o):(e.style.cssText="right:0;top:"+r.y+"px",r.y=r.y+10+o)}),r.x<=r.y?t.css("height",r.y+"px"):t.css("height",r.x+"px")}}}]}}]),angular.module("phoneApp").directive("footerBar",["$state","cachePool","ENV",function(e,t,o){var n=0,r=t.pull("UserInfo")||"";r&&(n=r.UserId);var l=[{route:"home.index"},{route:"forum.find"},{route:"forum.index"},{route:"msg.index"},{route:"member.index",options:{}}];return{restrict:"E",replace:!0,templateUrl:"common/directives/footer_bar.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,n,r,i,a,c){r.addPhoto=function(){if(o.isHybrid){var e=i('<section class="js_mod_camera" ngd-click="hideCamera($event)" selector="div"><div class="mod_camera"><ul><li ng-photo>相册</li><li ng-camera>拍照</li></ul></div><section>'),n=document.querySelector(".js_mod_camera");n?n.style.display="block":angular.element(document.querySelector(".pane")).after(e(t)),t.noScroll={"overflow-y":"hidden"}}else c.msgToast("请下载APP吧！")};var s=t.footerTab;t.menuChange=function(r){if("LI"==r.target.nodeName){var a=angular.element(r.target),u="left",p=a.attr("data-id");if(t.footerTab=p,3==p){if(o.isHybrid){var m=i('<section class="js_mod_camera" ngd-click="hideCamera($event)" selector="div"><div class="mod_camera"><ul><li ng-photo>相册</li><li ng-camera>拍照</li></ul></div><section>'),d=document.querySelector(".js_mod_camera");d?d.style.display="block":n.after(m(t)),t.noScroll={"overflow-y":"hidden"}}else c.msgToast("请下载APP吧！");return}s>p&&(u="right"),a.addClass("current"),e.go(l[p-1].route,l[p-1].options||{})}},t.hideCamera=function(e){var o=angular.element(e.delegationTarget);o.parent().css("display","none"),t.noScroll={"overflow-y":"auto"}}}]}}]).directive("addPhoto",["$parse","$timeout","$compile","widget","ENV",function(e,t,o,n,r){return{restrict:"A",link:function(e,t,l){t.on("click",function(){if(r.isHybrid){var t=o('<section class="js_mod_camera" ngd-click="hideCamera($event)" selector="div"><div class="mod_camera"><ul><li ng-photo>相册</li><li ng-camera>拍照</li></ul></div><section>'),l=document.querySelector(".js_mod_camera");l?l.style.display="block":angular.element(document.querySelector(".pane")).after(t(e)),e.noScroll={"overflow-y":"hidden"}}else n.msgToast("请下载APP吧！")}),e.hideCamera=function(t){var o=angular.element(t.delegationTarget);o.parent().css("display","none"),e.noScroll={"overflow-y":"auto"}}}}}]).directive("ngPhoto",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(e,t,o){function n(e){console.log("获取图片成功！"),sessionStorage.setItem("imageData",encodeURIComponent(e))}function r(e){console.log("获取图片失败！")}t.on("click",function(){window.navigator.camera.getPicture(n,r,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})})}}}]).directive("ngCamera",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(e,t,o){function n(e){console.log("获取图片成功！"),sessionStorage.setItem("imageData",encodeURIComponent(e))}function r(e){console.log("获取图片失败！")}t.on("click",function(){function e(){navigator.camera.getPicture(n,r,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA})}document.addEventListener("deviceready",e,!1)})}}}]),angular.module("phoneApp").directive("headerBar",["$window",function(e){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_bar.html",link:function(e,t,o){e.Page||(e.Page={}),e.Page.Title=e.Page.Title?e.Page.Title:o.title||"",e.Page.RightText=o.right?o.right.split("|")[0]:"",e.Page.RightFun=o.right?e.$eval(o.right.split("|")[1]||""):""}}}]).directive("headerOpacity",["$state","$ionicViewSwitcher","$window","cachePool","ENV",function(e,t,o,n,r){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_opacity.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,t,o,n,r,l){}]}}]),angular.module("phoneApp").directive("jobPopup",["$ionicPopup","widget","cachePool",function(e,t,o){return{restrict:"A",link:function(t,n,r){o.pull("JobData");t.tmpJob=t.inputVal.job,t.chooseJob=function(e){var o=angular.element(e.delegationTarget);o.length>0?t.tmpJob=o.find("label").text():t.inputVal.job=t.tmpJob},n.bind("click",function(){e.confirm({title:"选择岗位",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:t,templateUrl:"../common/directives/job_popup.html"}).then(function(e){e&&t.chooseJob(!1)})})}}}]),angular.module("phoneApp").directive("locationPopup",["$ionicPopup","widget","cachePool",function(e,t,o){return{restrict:"A",link:function(t,n,r){function l(){t.tmpVillage=t.villageList[0]}var i=o.pull("LocationData");i&&(t.cityList=i),t.cityList=[{Id:1,Name:"上海"},{Id:2,Name:"北京"},{Id:3,Name:"广州"},{Id:4,Name:"厦门"}],t.villageList=[{Id:11,Name:"长宁区"},{Id:12,Name:"徐汇徐"},{Id:23,Name:"朝阳区"},{Id:14,Name:"闸北区"}],t.inputVal.city=t.inputVal.city||t.cityList[0],t.inputVal.village=t.inputVal.village||t.villageList[0],t.tmpCity=t.inputVal.city,t.tmpVillage=t.inputVal.village,t.chooseLocation=function(e){var o=angular.element(e.delegationTarget),n=(o.text(),o.attr("data-city")),r=o.attr("data-village");o.parent("ul").find("li").removeClass("current"),o.addClass("current"),n&&(l(),t.tmpCity=t.$eval(n)),r&&(t.tmpVillage=t.$eval(r))},n.bind("click",function(){e.confirm({title:"选择位置",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:t,templateUrl:"../common/directives/location_popup.html"}).then(function(e){e&&(t.inputVal.city=t.tmpCity,t.inputVal.village=t.tmpVillage)})})}}}]),angular.module("phoneApp").directive("noNetwork",["$state","$stateParams",function(e,t){return{restrict:"E",templateUrl:"scripts/phoneApp/components/no-network/no-network.html",controller:["$scope",function(o){o.refreshPage=function(){var o=e.current,n=angular.copy(t);e.transitionTo(o,n,{reload:!0,inherit:!0,notify:!0})}}]}}]),angular.module("phoneApp").directive("noResults",["$state","$stateParams",function(e,t){return{restrict:"AE",templateUrl:"scripts/phoneApp/components/no-results/no-results.html",link:function(e,t,o){e.noResultsText=o.text?o.text:"抱歉，查询无结果",o.glass&&(e.hasGlass=!0)}}}]),angular.module("phoneApp").directive("pageBack",["$window","$state","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher",function(e,t,o,n,r,l){return{restrict:"A",link:function(t,o,n){o.on("click",function(){l.nextDirection("back"),e.history.back()})}}}]).directive("pageJump",["$window","$state","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher",function(e,t,o,n,r,l){return{restrict:"A",link:function(e,o,n){o.on("click",function(o){var i="forward";"none"==n.pageJump&&(i="none",e.loadMore={},r.clearCache(),r.clearHistory());var a=n.router,c=n.options?JSON.parse(n.options):{};l.nextDirection(i),t.go(a,c,{inherit:!1})})}}}]),angular.module("phoneApp").directive("searchHeader",["$state","$ionicViewSwitcher","widget","cachePool",function(e,t,o,n){return{restrict:"E",replace:!0,templateUrl:"common/directives/search_header.html",link:function(r,l,i){r.keyword="",r.toSearch=function(){if(r.keyword){var l=n.pull("Keyword")||[];angular.forEach(l,function(e,t){r.keyword==e&&l.splice(t,1)}),l.splice(0,0,r.keyword),n.push("Keyword",l),t.nextDirection("forward"),e.go("forum.search-result",{keyword:encodeURIComponent(r.keyword)})}else e.is("forum.search")?o.msgToast("请输入关键字！"):(t.nextDirection("forward"),e.go("forum.search"))}}}}]),angular.module("phoneApp").directive("shareCtrl",function(){return{restrict:"A",link:function(e,t){t.on("focus blur",function(e){var t=angular.element(e.path[1]);"focus"===e.type?t.addClass("focus"):t.removeClass("focus")})}}}),angular.module("phoneApp").directive("touchMove",["$parse",function(e){return{restrict:"A",compile:function(t,o){var n=e(o.touchMove);return function(e,t){t.on("touchstart",function(t){e.$apply(function(){n(e,{$event:t,$target:t.target})})}),t.on("touchmove",function(t){var o=t.touches[0],r=document.elementFromPoint(o.clientX,o.clientY);e.$apply(function(){n(e,{$event:t,$target:r})}),t.preventDefault()})}}}}]),angular.module("phoneApp").directive("userLogin",["$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(e,t,o,n,r,l){return{restrict:"E",replace:!0,templateUrl:"common/directives/user_login.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,t,o,n,r,l){e.tInput={},e.closeLogin=function(){t.removeClass("this_show")},e.showLogin=function(){t.css("display","block");r(function(){t.addClass("this_show")},50)},e.toLogin=function(){return e.tInput.phone?/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e.tInput.phone)?e.tInput.password?e.tInput.password.length<=5?void l.msgToast("新密码必须大于或等于6位"):(e.closeLogin(),r(function(){},300),void l.ajaxRequest({url:"getLogin",data:{Phone:e.tInput.phone,Password:e.tInput.Password},success:function(e){e.Response&&e.Response.State},error:function(e){}})):void l.msgToast("请输入密码"):void l.msgToast("手机号格式不合法"):void l.msgToast("请输入手机号")}}]}}]),angular.module("phoneApp").directive("getVcode",["$rootScope","$stateParams","$timeout","widget","$http","$q",function(e,t,o,n,r,l){return{restrict:"A",link:function(r,l,i){function a(){e.vDisableTime>0?(l.text("重新发送("+e.vDisableTime+")").addClass("disable"),e.vDisableTime--,e.vEnable=o(a,1e3)):l.text("重发验证码").removeClass("disable")}function c(){0===e.vDisableTime&&(e.vDisableTime=30,n.ajaxRequest({noMask:!0,url:"getClubHotUser",data:{Phone:t.phone},success:function(e){e.ShortMessage?(a(),n.msgToast(e.ShortMessage)):n.msgToast(e.msg||"手机号无效")}}))}t.phone&&(e.vEnable?(o.cancel(e.vEnable),a()):e.vDisableTime=0,c(),l.text("重新发送("+e.vDisableTime+")").addClass("disable").on("click",c))}}}]);