angular.module("phoneApp",["ngCordova","ionic","DelegateEvents"]).run(["$rootScope","$ionicLoading","$ionicPlatform","$cordovaNetwork","$cordovaKeyboard","$cordovaStatusbar","$cordovaSplashscreen","widget","ENV","$timeout",function(e,t,n,o,r,i,a,l,c,s){document.addEventListener("deviceready",function(){i.show(),r.hideAccessoryBar(!0),r.disableScroll(!0);o.isOnline();e.$on("$cordovaNetwork:offline",function(){l.msgToast("亲!世界上最遥远的距离就是木有网~")}),a.hide()},!1)}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("forum",{"abstract":!0,url:"/forum"}).state("forum.home",{url:"/index.htm",templateUrl:"home/tp/index.html",controller:"tDefault"}).state("forum.start",{url:"/start.htm",templateUrl:"home/tp/start.html",controller:"tStart"}).state("forum.entry",{url:"/entry.htm",templateUrl:"entry/tp/entry.html",controller:"tEntry"}).state("forum.login",{url:"/login.htm",templateUrl:"entry/tp/login.html",controller:"tLogin"}).state("forum.login-forget",{url:"/login/forget.htm",templateUrl:"entry/tp/forget.html",controller:"tLoginForget"}).state("forum.reg-create",{url:"/reg/create.htm",templateUrl:"entry/tp/reg_create.html",controller:"tRegCreate"}).state("forum.reg-account",{url:"/reg/account.htm",templateUrl:"entry/tp/reg_account.html",controller:"tRegAccount"}).state("forum.reg-done",{url:"/reg/done.htm",templateUrl:"entry/tp/reg_done.html",controller:"tRegDone"}).state("forum.reg-attent",{url:"/reg/attent.htm",templateUrl:"entry/tp/attent_cate.html",controller:"tAttentCate"}).state("forum.reg-follow",{url:"/reg/follow.htm",templateUrl:"entry/tp/follow.html",controller:"tFollow"}).state("forum.find",{url:"/find.htm",templateUrl:"forum/tp/find.html",controller:"tFindIndex"}).state("forum.like",{url:"/like.htm",templateUrl:"forum/tp/like.html",controller:"tFindLike"}).state("forum.photo-edit",{url:"/photo/edit.htm",templateUrl:"forum/tp/photo.html",controller:"tPhotoEdit"}).state("forum.photo-title",{url:"/photo/title.htm?type&club&activity&cate",templateUrl:"forum/tp/photo_title.html",controller:"tPhotoTitle"}).state("forum.photo-cate",{url:"/photo/cate.htm?id&step",templateUrl:"forum/tp/photo_cate.html",controller:"tPhotoCate"}).state("forum.club-hot",{url:"/club/hot.htm",templateUrl:"forum/tp/club_hot.html",controller:"tClubHot"}).state("forum.club-list",{url:"/club/list.htm",templateUrl:"forum/tp/club_list.html",controller:"tClubList"}).state("forum.club-detail",{url:"/club/detail-{id}.htm",templateUrl:"forum/tp/club_detail.html",controller:"tClubDetail"}).state("forum.club-ranking",{url:"/club/ranking-{id}.htm",templateUrl:"forum/tp/club_ranking.html",controller:"tClubRanking"}).state("forum.activity-list",{url:"/activity/list.htm",templateUrl:"forum/tp/activity_list.html",controller:"tActivityList"}).state("forum.activity-detail-photo",{url:"/activity/detail-photo-{id}.htm",templateUrl:"forum/tp/activity_detail_photo.html",controller:"tActivityDetailPhoto"}).state("forum.activity-detail-article",{url:"/activity/detail-article-{id}.htm",templateUrl:"forum/tp/activity_detail_article.html",controller:"tActivityDetailArticle"}).state("forum.subject-list",{url:"/subject/list.htm",templateUrl:"forum/tp/subject_list.html",controller:"tSubjectList"}).state("forum.subject-detail",{url:"/subject/detail-{id}.htm",templateUrl:"forum/tp/subject_detail.html",controller:"tSubjectDetail"}).state("forum.cate",{url:"/cate/list-{id}.htm",templateUrl:"forum/tp/cate_list.html",controller:"tCateList"}).state("forum.detail",{url:"/thread-{id}.htm",templateUrl:"forum/tp/article_detail.html",controller:"tArticleDetail"}).state("forum.edit",{url:"/edit-{id}.htm",templateUrl:"forum/tp/article_edit.html",controller:"tEdite"}).state("forum.comment-list",{url:"/comment/list-{id}.htm",templateUrl:"forum/tp/comment_list.html",controller:"tCommentList"}).state("forum.search",{url:"/search/index",templateUrl:"forum/tp/search.html",controller:"tSearchIndex"}).state("forum.search-result",{url:"/search/result?keyword",templateUrl:"forum/tp/search-result.html",controller:"tSearchResult"}).state("forum.chat",{url:"/chat-{uid}.htm?{name}",templateUrl:"forum/tp/chat.html",controller:"tMsgChat"}).state("forum.msg-index",{url:"/msg/index.htm",templateUrl:"msg/tp/index.html",controller:"tMsgIndex"}).state("forum.msg-notice",{url:"/msg/notice.htm",templateUrl:"msg/tp/notice.html",controller:"tMsgNotice"}).state("forum.msg-comment",{url:"/msg/comment.htm",templateUrl:"msg/tp/comment.html",controller:"tMsgComment"}).state("forum.msg-praise",{url:"/msg/praise.htm",templateUrl:"msg/tp/praise.html",controller:"tMsgPraise"}).state("forum.msg-search",{url:"/msg/search.htm",templateUrl:"msg/tp/search.html",controller:"tMsgSearch"}).state("forum.msg-talk",{url:"/msg/talk.htm",templateUrl:"msg/tp/talk.html",controller:"tMsgTalk"}).state("forum.user-index",{url:"/user/index.htm",templateUrl:"user/tp/index.html",controller:"tUserIndex"}).state("forum.user-other-index",{url:"/user/index-{uid}.htm",templateUrl:"user/tp/user_index.html",controller:"tUserOtherIndex"}).state("forum.user-about",{url:"/user/about.htm",templateUrl:"user/tp/about.html",controller:"tUserAbout"}).state("forum.user-feedback",{url:"/user/feedback.htm",templateUrl:"user/tp/feedback.html",controller:"tUserFeedback"}).state("forum.user-level",{url:"/user/level.htm",templateUrl:"user/tp/level.html",controller:"tUserLevel"}).state("forum.user-article-list",{url:"/user/article-{uid}-{cate}.htm?name",templateUrl:"user/tp/article_list.html",controller:"tUserArticleList"}).state("forum.user-article",{url:"/user/article-{uid}.htm?name",templateUrl:"user/tp/article.html",controller:"tUserArticle"}).state("forum.user-collect-list",{url:"/user/collect-{uid}-{cate}.htm?name",templateUrl:"user/tp/collect_list.html",controller:"tUserCollectList"}).state("forum.user-collect",{url:"/user/collect-{uid}.htm?name",templateUrl:"user/tp/collect.html",controller:"tUserCollect"}).state("forum.user-fans",{url:"/user/fans-{uid}.htm?name",templateUrl:"user/tp/fans.html",controller:"tUserFans"}).state("forum.user-attention",{url:"/user/attention-{uid}.htm?name",templateUrl:"user/tp/attention.html",controller:"tUserAttention"}).state("forum.user-club",{url:"/user/club-{uid}.htm?name",templateUrl:"user/tp/club.html",controller:"tUserClub"}).state("forum.userData",{url:"/user/{id}-data.htm",templateUrl:"user/tp/personal_data.html",controller:"userDataCtrl"}).state("forum.user-set",{url:"/user/set.htm",templateUrl:"user/tp/set.html",controller:"tUserSet"}).state("forum.user-set-password",{url:"/user/set/password.htm",templateUrl:"user/tp/set_password.html",controller:"tUserSetPassword"}).state("forum.user-set-bind",{url:"/user/set/bind.htm",templateUrl:"user/tp/set_bind.html",controller:"tUserSetBind"}).state("forum.report",{url:"/report-{type}-{id}.htm?title",templateUrl:"forum/tp/report.html",controller:"tReport"});var n=JSON.parse(localStorage.getItem("PHONEAPP_START"));n=!1,t.otherwise(n?"/forum/index.htm":"/forum/index.htm")}]),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/city_list.html",'<section class="mod_city_list" ngd-click="toggleCity($event)" selector="dt">\n    <ul>\n        <li ng-click="cancleCity()">取消</li>\n        <li>{{City.tmpName}}</li>\n        <li ng-click="submitCity()">确定</li>\n    </ul>\n\n    <div ngd-click="selectCity($event)" selector="p">\n        <dl ng-repeat="(k, v) in CityList track by $index" ng-class="{open: v.id == City.tmpMid}">\n            <dt data-mid="{{v.id}}" data-mkey="{{k}}" data-name="{{v.name}}">{{v.name}}</dt>\n            <dd>\n                <p ng-repeat="(i, n) in v.sub track by $index" ng-class="{current: n.id == City.tmpSid}" data-sid="{{n.id}}" data-skey="{{k}}" data-name="{{n.name}}">\n                    {{n.name}}\n                </p>\n            </dd>\n        </dl>\n    </div>\n</section>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/detail_menu.html",'<section class="mod_detail_menu" ng-class="{t_show: showDM}">\n    <div class="t_list">\n<!--         <div ng-if="isHybrid" class="t_scroll">\n            <h3>分享到社交网络</h3>\n            <ion-scroll direction="x" scrollbar-x="false" locking="false">\n                <ul>\n                    <li class="t_weixin_f">\n                        微信好友\n                    </li>\n                    <li class="t_weixin_q">\n                        微信朋友圈\n                    </li>\n                    <li class="t_weibo">\n                        新浪微博\n                    </li>\n                    <li class="t_qq">\n                        QQ好友\n                    </li>\n                </ul>\n            </ion-scroll>\n        </div> -->\n\n        <!-- <h3>内容相关</h3> -->\n        <div class="t_scroll">\n            <ion-scroll direction="x" scrollbar-x="false" locking="false">\n                <ul>\n                    <li ng-if="!UserState.isOwner" page-jump data-router="forum.report" data-options="{type: \'article\', id: Deploy.ArticleId, title: DataList.Author.UserName}" class="t_report">\n                        举报\n                    </li>\n                    <li ng-if="!UserState.isOwner" ng-click="setCollect()" class="t_collect">\n                        收藏\n                    </li>\n                    <li ng-if="!UserState.isOwner" page-jump="login" data-router="forum.chat" data-options="{uid: DataList.Author.UserId, name:DataList.Author.UserName}" class="t_msg">\n                        私聊\n                    </li>\n                    <li ng-click="setPraise()" class="t_hit">\n                        赞\n                    </li>\n<!--                     <li ng-if="UserState.isOwner" ng-click="doEdit()" class="t_edit">\n                        编辑\n                    </li>\n                    <li ng-if="UserState.isOwner" ng-click="doDelete()" class="t_del">\n                        删除\n                    </li> -->\n                </ul>\n            </ion-scroll>\n        </div>\n\n        <p ng-click="hideMenu()">取消</p>\n    </div>\n</section>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/footer_bar.html",'<ion-footer-bar>\n    <footer class="mod_footer">\n        <a ng-class="{current : footerTab == 1}" page-jump="none" data-router="forum.home">\n            首页\n        </a>\n        <a ng-class="{current : footerTab == 2}" page-jump="none" data-router="forum.find">\n            发现\n        </a>\n        <p add-photo ng-class="{current : footerTab == 3}"></p>\n        <a ng-class="{current : footerTab==4, new : isMessage}" page-jump="none" data-router="forum.msg-index">\n            消息\n        </a>\n        <a ng-class="{current : footerTab == 5}" page-jump="none" data-router="forum.user-index">\n            我\n        </a>\n    </footer>\n</ion-footer-bar>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_bar.html",'<ion-header-bar class="mod_header" ng-class="{transparent:isTransparent}" ng-style="HeaderBg" align-title="center" no-tap-scroll="true">\n	<div class="buttons">\n		<button page-back class="back_button"></button>\n	</div>\n	\n    <h1 class="title" ng-bind-html="Page.Title"></h1>\n\n	<div class="buttons buttons-right" ng-if="Page.RightText">\n		<button class="right_button" ng-click="Page.RightFun()">{{Page.RightText}}</button>\n	</div>\n\n    <!-- <div class="buttons buttons-right" ng-if="Page.Next">\n        <button class="right_button" page-jump data-router="{{Page.SiteUrl.router}}" data-options="{{Page.SiteUrl.options}}">{{Page.Next}}</button>\n    </div> -->\n</ion-header-bar>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_opacity.html",'<header class="mod_header_opacity">\n    <ul>\n        <li></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n    <ul class="this_op">\n        <li page-back></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_opacity_detail.html",'<header class="mod_header_opacity">\n    <ul>\n        <li></li>\n        <li></li>\n        <li ng-class="{t_more: isHeaderMenu}"></li>\n    </ul>\n    <ul class="this_op">\n        <li page-back></li>\n        <li>{{PageTitle}}</li>\n        <li ng-if="isHeaderMenu" class="t_more" ng-click="RightFun()"></li>\n        <li ng-if="!isHeaderMenu"></li>\n    </ul>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/header_opacity_user.html",'<header class="user_header">\n    <ul>\n        <li></li>\n        <li>我</li>\n        <li></li>\n    </ul>\n    <ul class="this_op">\n        <li ng-click="toMail()"></li>\n        <li>我</li>\n        <li page-jump data-router="forum.user-set" ng-if="UserInfo.UserId"></li>\n        <li ng-click="showLogin()" ng-if="!UserInfo.UserId"></li>\n    </ul>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/job_popup.html",'<div class="choose_job" ngd-click="chooseJob($event)" selector="li">\n	<ul>\n		<li ng-repeat="(k, v) in DataList.JobList track by $index" data-id="{{v.Id}}" data-name="{{v.Name}}" ng-class="{ current : tmpJob == {{v.Id}} }">\n			{{v.Name}}\n		</li>\n	</ul>\n</div>\n\n<!-- <div class="choose_post" ngd-click="chooseJob($event)" selector="li">\n	<ul>\n		<li>\n			<input ng-checked="tmpJob == \'园长\'" name="job" type="radio">\n			<label>园长</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'保教主任\'" name="job" type="radio">\n			<label>保教主任</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'教师\'" name="job" type="radio">\n			<label>教师</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'其他\'" name="job" type="radio">\n			<label>其他</label>\n		</li>\n	</ul>\n</div> -->')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/location_popup.html",'<div class="choose_location" ngd-click="chooseLocation($event)" selector="li">\n	<ion-scroll class="select_box">\n		<ul data-type="main">\n			<li ng-repeat="(k, v) in CityList track by $index" ng-class="{current: v.id == tmpMid }" data-mid="{{v.id}}" data-mkey="{{k}}">\n				{{v.name}}\n			</li>\n		</ul>\n	</ion-scroll>\n	<ion-scroll class="select_box">\n		<ul data-type="sub">\n			<li ng-repeat="(k, v) in CitySubList track by $index" ng-class="{current: v.id == tmpSid }" data-sid="{{v.id}}" data-skey="{{k}}">\n				{{v.name}}\n			</li>\n		</ul>\n	</ion-scroll>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/mod_loading.html",'<ion-spinner icon="ios"></ion-spinner>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/no_network.html",'<div ng-if="noNetwork" class="no-network"> <i class="icon-no-network"></i>\n	网络不给力，刷新页面重试\n	<button ng-click="refreshPage();" class="button button-block button-positive">刷新页面</button>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/no_results.html",'<div ng-if="noResults" class="no-results">\n    <i ng-if="hasGlass" class="icon-search"></i>\n    {{noResultsText}}\n</div>\n')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/page_sheet.html",'<section class="mod_sheet" ng-click="hideSheet()">\n    <div>\n        <ul ngd-click="toSheet($event)" selector="li">\n            <li data-type="camera">拍照</li>\n            <li data-type="photo">照片图库</li>\n            <li data-type="close">取消</li>\n        </ul>\n    </div>\n</section>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/search_header.html",'<header class="mod_header_search">\n    <div>\n        <input ng-model="keyword" type="text" value="" placeholder="搜索内容/标签/圈子/用户" />\n        <button ng-click="toSearch()"></button>\n    </div>\n</header>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/user_login.html",'<div class="user_login_pop">\n    <div class="this_cancel" ng-click="closeLogin()">取消</div>\n\n    <dl>\n        <dt></dt>\n        <dd>\n            <ul>\n                <li><input ng-model="tInput.phone" type="tel" placeholder="输入手机号" /></li>\n                <li><input ng-model="tInput.password" type="password" placeholder="输入密码" /></li>\n                <li class="this_login" ng-click="toLogin()">登录</li>\n                <li class="this_link">\n                    <div page-jump data-router="forum.login-forget">找回密码</div>\n                    <p></p>\n                    <div page-jump data-router="forum.reg-create">注册账号</div>\n                </li>\n            </ul>\n        </dd>\n    </dl>\n</div>')}])}(),function(e){try{e=angular.module("phoneApp")}catch(t){e=angular.module("phoneApp",[])}e.run(["$templateCache",function(e){e.put("common/directives/user_login_page.html",'<div class="user_login_page">\n    <div class="this_cancel" page-back>取消</div>\n\n    <dl>\n        <dt></dt>\n        <dd>\n            <ul>\n                <li><input ng-model="tInput.phone" type="tel" placeholder="输入手机号" /></li>\n                <li><input ng-model="tInput.password" type="password" placeholder="输入密码" /></li>\n                <li class="this_login" ng-click="toLogin()">登录</li>\n                <li class="this_link">\n                    <div page-jump data-router="forum.login-forget">找回密码</div>\n                    <p></p>\n                    <div page-jump data-router="forum.reg-create">注册账号</div>\n                </li>\n            </ul>\n        </dd>\n    </dl>\n</div>')}])}(),angular.module("phoneApp").factory("cachePool",function(){var e=function(e){if(!e)return null;var t,n=localStorage.getItem("phoneApp_"+e);try{t=JSON.parse(n)}catch(o){}return t?t:null},t=864e5,n={push:function(n,o,r){if(n&&o){var i=e(n)||{};i.value=o||void 0,i.expired=r?Date.now()+t*r:void 0,localStorage.setItem("phoneApp_"+n,JSON.stringify(i))}},pull:function(t){var n,o=e(t);return!o||o.expired&&o.expired<=Date.now()?null:n=o.value},remove:function(t,n){if(t){var o=e(t);return o?void(n&&o[n]?(o[n]=void 0,localStorage.setItem("phoneApp_"+t,JSON.stringify(o))):localStorage.removeItem("phoneApp_"+t)):void localStorage.removeItem("phoneApp_"+t)}},modify:function(t,n){if(t){var o,r=e(t);if(!r)return void localStorage.removeItem("phoneApp_"+t);if(n){for(o in r.value)n[o]&&(r.value[o]=n[o]);localStorage.setItem("phoneApp_"+t,JSON.stringify(r))}}}};return n}),angular.module("phoneApp").factory("ENV",["$location",function(e){var t=navigator.userAgent.toLowerCase(),n={apiSocket:"http://m.tjoys.net:8092/api/",isHybrid:!1,isWeixin:!1,isApple:!1,isAndroid:!1,appVersion:isVersionCreatePhoneApp};return window.isHybridCreatePhoneApp&&(n.isHybrid=!0),n.isHybrid&&/android/.test(t)&&(n.isAndroid=!0),n.isHybrid&&/iphone|ipad|ipod/.test(t)&&(n.isApple=!0,document.getElementById("js_view").className="is_ios"),/micromessenger/.test(t)&&(n.isWeixin=!0),n}]),angular.module("phoneApp").filter("ellipsis",function(){return function(e,t){return e&&t>0&&e.length>t?e.substring(0,t-2)+"…":e}}).filter("specDate",["$filter",function(e){return function(t,n){if(t){t=new Date(t.replace(new RegExp("-","gm"),"/")).getTime();var o=1e3*n-t,r="刚刚",i=36e5,a=6e4;return o>24*i?r=e("date")(t,"yyyy-MM-dd"):o>i?r=Math.floor(o/i)+"小时前":o>10*a&&(r=Math.floor(o/a)+"分钟前"),r}}}]).filter("repbr",function(){return function(e){var t=new RegExp("<br>","g");return e.replace(t,"\n")}}),angular.module("phoneApp").config(["$provide","$httpProvider",function(e,t){e.factory("httpInterceptor",["$q","ENV",function(e,t){var n={request:function(t){t.url;return t||e.when(t)},requestError:function(t){return e.reject(t)},response:function(t){return t||e.when(t)},responseError:function(t){return e.reject(t)}};return n}]),t.interceptors.push("httpInterceptor")}]),angular.module("phoneApp").factory("widget",["$q","$http","$state","$compile","$timeout","$location","$rootScope","$cacheFactory","$ionicLoading","$ionicHistory","$ionicBackdrop","$ionicViewSwitcher","$ionicScrollDelegate","cachePool","ENV","$cordovaDevice","$cordovaKeyboard",function(e,t,n,o,r,i,a,l,c,s,u,m,d,p,h,g,f){a.isHybrid=h.isHybrid?!0:!1,a.dUserImageG="themes/img/user_image_gray.png",a.dUserImageW="themes/img/user_image_white.png",a.dUserImageL="themes/img/user_image_logo.png",a.thumbGreen="themes/img/thumb_green.jpg",a.thumbArt="themes/img/thumb_article.jpg";var v=null,y=l("dataPool"),b={msgToast:function(e,t){var n=angular.element(document.querySelector(".notifier"));if(!n.length){var i=o('<div class="notifier" ng-click="notification=null" ng-show="notification"><span>{{notification}}</span></div>');angular.element(document.getElementsByTagName("body")[0]).append(i(a))}r(function(){a.notification=e},0),r.cancel(v),v=r(function(){a.notification=""},t||2e3)},cacheData:function(e,t){if(!angular.isString(e))return!1;var n=y.get(e);return t?void y.put(e,t):n?n:!1},safeApply:function(e,t){e&&t&&(e.$$phase||e.$root&&e.$root.$$phase?t():e.$apply(t))},ajaxRequest:function(e){var n=this;if(e){var o=e.scope||"",r=e.data||{},i={Header:{UserId:"",Auth:""}};if(a.UserInfo=n.getLogin(),a.UserInfo&&a.UserInfo.UserId&&(i.Header.UserId=a.UserInfo.UserId,i.Header.Auth=a.UserInfo.Auth),r=angular.extend({},r,i),e.showPage){if(o.Deploy.isLoading)return;o.Deploy.isLoading=!0,o.Deploy.pageIndex++,angular.extend(r,{PageIndex:o.Deploy.pageIndex,PageSize:o.Deploy.pageSize})}var l={success:function(){},msgError:"",error:function(){},showError:!0,showPage:!1,showLoading:!0},s={method:"POST",url:h.apiSocket+e.url||"",data:r,timeout:15e3};for(var u in e)l[u]=e[u];l.showLoading&&(!l.showPage||l.showPage&&o.Deploy.pageIndex<2)&&c.show({templateUrl:"common/directives/mod_loading.html"}),t(s).success(function(t){t.Response&&"Success"==t.Response.Ack?(o&&!o.Deploy&&(o.Deploy={}),t.Response.State||n.cleanLogin(),"function"==typeof l.success&&l.success(t),e.showPage&&(o.Deploy.isLoading=!1,o.Deploy.pageTotal=t.Total||0,!o.Deploy.pageTotal||o.Deploy.pageTotal&&o.Deploy.pageIndex*o.Deploy.pageSize>=o.Deploy.pageTotal?(o.Deploy.isLoading=!0,o.Deploy.isMore=!1):o.$broadcast("scroll.infiniteScrollComplete"))):(n.msgToast(l.msgError?l.msgError:"数据请求错误！"),o.Deploy&&l.showPage&&(o.Deploy.isMore=!1)),l.showLoading&&c.hide()}).error(function(e){l.showLoading&&c.hide(),o&&o.Deploy&&l.showPage&&(o.Deploy.isMore=!1),l.showPage&&(o.Deploy.isLoading=!1),l.showError&&n.msgToast("网络错误，请稍后再试！"),l.error(e)})}},showStatusBar:function(){function e(){StatusBar.show()}h.isHybrid&&document.addEventListener("deviceready",e,!1)},clearHistory:function(){s.clearHistory()},clearView:function(){s.clearCache(),s.clearHistory()},setLogin:function(e){var t=this;t.getJobName(e.Job).then(function(n){var n=n;t.getCityName(e.Area).then(function(t){p.push("UserInfo",{UserId:e.UserId,Auth:e.Auth,Phone:e.Phone,UserName:e.UserName,UserImage:e.UserImage,Sex:e.Sex,SexName:2==e.Sex?"女":"男",Area:e.Area,AreaName:t,Job:e.Job,JobName:n},30),a.UserInfo=p.pull("UserInfo")})})},modifyLogin:function(e){function t(){p.modify("UserInfo",e),a.UserInfo=p.pull("UserInfo")}var n=this,o="no";if(e.Sex)switch(e.Sex){case 1:e.SexName="男";break;case 2:e.SexName="女"}switch(e.Job&&e.Area?o="all":e.Job?o="job":e.Area&&(o="area"),o){case"job":n.getJobName(e.Job).then(function(n){e.JobName=n,t()});break;case"area":n.getCityName(e.Area).then(function(n){e.AreaName=n,t()});break;case"all":n.getJobName(e.Job).then(function(o){e.JobName=o,n.getCityName(e.Area).then(function(n){e.AreaName=n,t()})});break;default:t()}},getLogin:function(){var e=p.pull("UserInfo");return e||(e={UserId:0}),e},cleanLogin:function(){p.remove("UserInfo"),a.UserInfo={UserId:0}},toLogin:function(){m.nextDirection("forward"),n.go("forum.entry",{},{inherit:!1})},checkPhone:function(e){var t=this,n=!1;return e||(t.msgToast("请输入手机号码"),n=!0),/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e)||(t.msgToast("手机号码格式不合法"),n=!0),n},toBack:function(e){var e=e||-1;return m.nextDirection("back"),s.backView()?void s.goBack(e):void n.go("forum.home")},getSetting:function(){p.pull("SettingData")||p.push("SettingData",{isMsgPush:!0,isFocusOnly:!1,isTelAllow:!0,isPhotoSave:!1,isPhotoEdit:!1});var e=p.pull("SettingData");return e},getJobList:function(){var n=e.defer();return t({method:"GET",url:"data/getJobList.json",timeout:15e3}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},getJobName:function(e){var t=this,n=t.getJobList().then(function(t){var n;return angular.forEach(t.JobList,function(t,o){t.Id==e&&(n=t.Name)}),n},function(e){return null});return n},getCityList:function(){var n=e.defer();return t({method:"GET",url:"data/getCityList.json",timeout:15e3}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},getCityName:function(e){var t=this,n=t.getCityList().then(function(t){var n;return angular.forEach(t,function(t,o){angular.forEach(t.sub,function(o,r){return o.id==e?void(n=t.name+" "+o.name):void 0}),n}),n},function(e){return null});return n}};return a.UserInfo=b.getLogin(),b}]),angular.module("phoneApp").directive("appFilereader",["$q","$parse","widget",function(e,t,n){var o=Array.prototype.slice;return{restrict:"A",require:"?ngModel",link:function(t,r,i,a){a&&(a.$render=function(){},r.bind("change",function(r){function i(t){var n=e.defer(),o=new FileReader;return o.onload=function(e){n.resolve(e.target.result)},o.onerror=function(e){n.reject(e)},o.readAsDataURL(t),n.promise}function l(e){var t=angular.element(document.querySelector("#tmp"))[0],n=t.getContext("2d"),o=new Image;o.onload=function(){EXIF.getData(o,function(){var e=EXIF.pretty(this),r=e?e.Orientation:1;n.drawImage(o,0,0);var i=new MegaPixImage(o);i.render(t,{maxWidth:1e3,quality:1,orientation:r},function(){var e=t.toDataURL("image/jpeg");a.$setViewValue(e)})})},o.src=e}var c=r.target;e.all(o.call(c.files,0).map(i)).then(function(e){e&&0!=e.length&&(c.multiple?angular.forEach(e,function(e,t){l(e)}):l(e[0]),n.cacheData("CameraImages",t.CameraImages))})}))}}}]).directive("webUserimage",["$q","$parse","widget",function(e,t,n){var o=Array.prototype.slice;return{restrict:"A",require:"?ngModel",link:function(t,r,i,a){a&&(a.$render=function(){},r.bind("change",function(r){function i(t){var n=e.defer(),o=new FileReader;return o.onload=function(e){n.resolve(e.target.result)},o.onerror=function(e){n.reject(e)},o.readAsDataURL(t),n.promise}function l(e){var o=angular.element(document.querySelector("#tmp"))[0],r=o.getContext("2d"),i=new Image;i.onload=function(){EXIF.getData(i,function(){var e=EXIF.pretty(this),l=e?e.Orientation:1;r.drawImage(i,0,0);var c=new MegaPixImage(i);c.render(o,{maxWidth:640,maxHeight:640,quality:1,orientation:l},function(){var e=o.toDataURL("image/jpeg");n.ajaxRequest({scope:t,msgError:"头像修改失败",url:"setUserImage",data:{ImageData:e},success:function(e){a.$setViewValue(e.ImageUrl)}})})})},i.src=e}var c=r.target;e.all(o.call(c.files,0).map(i)).then(function(e){e&&0!=e.length&&(c.multiple?angular.forEach(e,function(e,t){l(e)}):l(e[0]))})}))}}}]).directive("appUserimage",["$timeout","$cordovaCamera","$cordovaActionSheet","widget",function(e,t,n,o){return{restrict:"A",link:function(e,r,i){r.on("click",function(){function r(t){var n=angular.element(document.querySelector("#tmp"))[0],r=n.getContext("2d"),i=new Image;i.onload=function(){EXIF.getData(i,function(){var t=EXIF.pretty(this),a=t?t.Orientation:1;r.drawImage(i,0,0);var l=new MegaPixImage(i);l.render(n,{maxWidth:640,maxHeight:640,quality:1,orientation:a},function(){var t=n.toDataURL("image/jpeg");o.ajaxRequest({scope:e,msgError:"头像修改失败",url:"setUserImage",data:{ImageData:t},success:function(t){e.cInput.UserImage=t.ImageUrl,o.modifyLogin({UserImage:t.ImageUrl})}})})})},i.src=t}if(!e.UserInfo.UserId)return void e.showLogin();var i={buttonLabels:["拍照","照片图库"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0,winphoneEnableCancelButton:!0};document.addEventListener("deviceready",function(){n.show(i).then(function(e){var n={quality:100,encodingType:Camera.EncodingType.JPEG,allowEdit:!0,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY};1==e&&(n.sourceType=Camera.PictureSourceType.CAMERA),t.getPicture(n).then(function(e){r(e)},function(e){console.log(e)})})},!1)})}}}]).directive("addPhoto",["$state","$parse","$timeout","$compile","$cordovaCamera","$ionicViewSwitcher","widget","ENV",function(e,t,n,o,r,i,a,l){return{restrict:"A",link:function(t,n,c){n.on("click",function(){return t.UserInfo.UserId?(l.isHybrid||(i.nextDirection("forward"),e.go("forum.photo-title")),void document.addEventListener("deviceready",function(){var e=o('<div class="mod_camera" ng-style="styleCamera"><div ng-click="hideCamera()"></div><ul><li ng-click="appUpload(2)">相册</li><li ng-click="appUpload(1)">拍照</li></ul></div>'),n=document.querySelector(".js_mod_camera");n?n.style.display="block":angular.element(document.querySelector(".pane")).after(e(t)),t.styleScroll={"overflow-y":"hidden"}},!1)):void t.showLogin()}),t.hideCamera=function(){t.styleCamera={display:"none"},t.styleScroll={"overflow-y":"auto"}},t.appUpload=function(n){t.hideCamera();var o={quality:100,encodingType:Camera.EncodingType.JPEG,allowEdit:a.getSetting().isPhotoEdit,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY};1==n&&(o.saveToPhotoAlbum=a.getSetting().isPhotoSave,o.sourceType=Camera.PictureSourceType.CAMERA),r.getPicture(o).then(function(t){sessionStorage.setItem("imageData",encodeURIComponent(t)),i.nextDirection("forward"),e.go("forum.photo-title",{type:"other"})},function(e){console.log(e)})}}}}]).directive("addImage",["$timeout","$cordovaCamera","$cordovaActionSheet","widget",function(e,t,n,o){return{restrict:"A",link:function(r,i,a){i.on("click",function(){function i(t){r.Deploy.isUpload=!0;var n=angular.element(document.querySelector("#tmp"))[0],o=n.getContext("2d"),i=new Image;i.onload=function(){EXIF.getData(i,function(){var t=EXIF.pretty(this),a=t?t.Orientation:1;o.drawImage(i,0,0);var l=new MegaPixImage(i);l.render(n,{maxWidth:1e3,quality:1,orientation:a},function(){var t=n.toDataURL("image/jpeg");e(function(){r.Deploy.isUpload=!1,r.Deploy.currentImage=t},2e3)})})},i.src=t}if(r.SettingData=o.getSetting(),!r.UserInfo.UserId)return void r.showLogin();var a={buttonLabels:["拍照","照片图库"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0,winphoneEnableCancelButton:!0};document.addEventListener("deviceready",function(){n.show(a).then(function(e){var n={quality:100,encodingType:Camera.EncodingType.JPEG,allowEdit:r.SettingData.isPhotoEdit,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY};1==e&&(n.saveToPhotoAlbum=r.SettingData.isPhotoSave,n.sourceType=Camera.PictureSourceType.CAMERA),t.getPicture(n).then(function(e){i(e)},function(e){console.log(e)})})},!1)})}}}]),angular.module("phoneApp").directive("checkUser",["$state","$rootScope","cachePool","widget",function(e,t,n,o){return{controller:function(){t.$on("$stateChangeStart",function(e,t,o,r,i){
var a=0,l=n.pull("UserInfo")||"";return l&&(a=l.UserId),console.log(a),t.resolve&&t.resolve.isCheck()&&!a?(console.log(1231231),void(window.location.href="/#/entry/login.htm")):void 0})}}}]),angular.module("phoneApp").directive("cityList",["$http","$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(e,t,n,o,r,i,a){return{restrict:"E",replace:!0,templateUrl:"common/directives/city_list.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,n,o,r,i,a){t.City||(t.City={}),t.City.tmpName||(t.City.tmpName="选择城市"),e({method:"GET",url:"data/getCityList.json",timeout:15e3}).success(function(e){t.CityList=e}),t.toggleCity=function(e){var n=angular.element(e.delegationTarget);return n.parent("dl").hasClass("open")?void(t.City.tmpMid=0):(t.City.tmpMname=n.attr("data-name"),void(t.City.tmpMid=n.attr("data-mid")))},t.selectCity=function(e){var n=angular.element(e.delegationTarget);t.City.tmpName=t.City.tmpMname+" "+n.attr("data-name"),t.City.tmpSid=n.attr("data-sid"),t.City.tmpCityId=t.City.tmpSid},t.cancleCity=function(e){t.City.tmpMid=0,t.City.tmpSid=0,t.City.tmpCityId=0,t.City.tmpName="选择城市",t.styleScroll={"overflow-y":"auto"},t.hideCity()},t.submitCity=function(e){return t.City.tmpCityId?(t.cInput.Area=t.City.tmpCityId,t.cInput.AreaName=t.City.tmpName,t.Page||(t.Page={}),t.Page.isModify=!0,void t.hideCity()):void a.msgToast("请选择您所在的位置！")},t.showCity=function(){n.css("display","block");t.styleScroll={"overflow-y":"hidden"},i(function(){n.addClass("this_show")},50)},t.hideCity=function(){n.removeClass("this_show")},t.choiceCity=function(){return t.CityList&&0!=t.CityList.length?(angular.forEach(t.CityList,function(e,n){angular.forEach(e.sub,function(n,o){n.id==t.cInput.Area&&(t.City.tmpMid=e.id,t.City.tmpMname=e.name)})}),t.City.tmpSid=t.cInput.Area,t.City.tmpCityId=t.cInput.Area,t.City.tmpName=t.cInput.AreaName,void t.showCity()):void a.msgToast("网络错误，请稍后再试！")}}]}}]),angular.module("phoneApp").directive("collectionCtrl",["$timeout","Util","DataCachePool",function(e,t,n){return{restrict:"A",link:function(t,o,r){var i=JSON.parse(r.item?r.item:!1);if(i){var a=n.pull("COLLECTION_GOODS")||[],l=-1,c=function(e){return void 0===e?r.index?t.isCollect[r.index]:t.isCollect:void(r.index?t.isCollect[r.index]=e:t.isCollect=e)};e(function(){for(var e=0;e<a.length;e++)if(a[e].InnerId===i.InnerId){l=e,c(!0);break}},0),o.on("click",function(t){if(c())e(function(){c(!1)},100),a.splice(l,1),n.push("COLLECTION_GOODS",a);else{e(function(){c(!0)},100);var o={Id:i.ProductID,InnerId:i.InnerId,Title:i.Name,ImgUrl:i.Picture};a.unshift(o),n.push("COLLECTION_GOODS",a)}})}}}}]),angular.module("phoneApp").directive("contenteditable",function(){return{require:"?ngModel",link:function(e,t,n,o){o&&(t.on("focus",function(e){var t=angular.element(e.target);"备注要求"===t.text()&&t.text("")}),t.on("blur",function(e){var t=angular.element(e.target);""===t.text()&&t.text("备注要求")}),t.on("input",function(){var n=t.html();n=n.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,""),e.$apply(function(){o.$setViewValue(n),o.$render()})}),t.on("keyup",function(t){return 13===t.keyCode?(console.log(e.remark),!1):void 0}),o.$render=function(){t.html(o.$viewValue)},o.$render())}}}),function(){var e=document.documentElement,t=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector,n=function(e,n){return t?t.call(e,n):e.tagName.toLowerCase()===n},o=function(t,o,r){for(r||(r=e);t&&t!=r&&r.contains(t);){if(n(t,o))return t;t=t.parentNode}return null},r={};e.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))});var i=/^\s*?{.+}\s*?$/;angular.forEach("Event Click Dblclick Mousedown Mouseup Mouseover Mouseout Mousemove Mouseenter Mouseleave".split(" "),function(e){var t="ngd"+e;r[t]=["$parse",function(n){return function(r,a,l){function c(e,t){var i=n(e);a.on(t,function(e){var n,l=e.target;(n=o(l,"string"==typeof s?s:s[t],a[0]))&&(e.delegationTarget=n,i(angular.element(n).scope(),{$event:e,$params:[].slice.call(arguments,1)}),r.$$phase||r.$apply())})}var s=l.selector,u="Event"==e?l.eventName||"click":e.toLowerCase(),m=l[t];s.match(i)&&(s=r.$eval(s)),m.match(i)?(m=r.$eval(m),angular.forEach(m,c)):c(m,u)}}]}),angular.module("DelegateEvents",[]).directive(r)}(),angular.module("phoneApp").directive("detailMenu",["$http","$state","$timeout","$rootScope","$ionicViewSwitcher","cachePool","widget","ENV",function(e,t,n,o,r,i,a,l){return{restrict:"E",replace:!0,templateUrl:"common/directives/detail_menu.html",link:function(e,t,o,i){t.on("click",function(){e.hideMenu()}),e.hideMenu=function(){t.addClass("t_hide"),n(function(){e.showDM=!1,t.removeClass("t_hide")},400)},e.setCollect=function(){return e.UserInfo.UserId?2==e.DataList.Total.StateCollect?void a.msgToast("您已经收藏过啦！"):void a.ajaxRequest({scope:e,msgError:"帖子收藏失败",url:"setArticleCollect",data:{ArticleId:e.Deploy.ArticleId},success:function(e){a.msgToast("帖子收藏成功")}}):void e.showLogin()},e.doEdit=function(){},e.setDelete=function(){return e.UserInfo.UserId?void a.ajaxRequest({scope:e,msgError:"删除失败",url:"setArticleDel",data:{ArticleId:e.Deploy.ArticleId},success:function(e){a.msgToast("删除成功"),r.nextDirection("back"),$ionicHistory.goBack()}}):void e.showLogin()}}}}]),angular.module("phoneApp").directive("falls",["$q","$timeout","$rootScope",function(e,t,n){return{restrict:"E",replace:!0,transclude:!0,template:'<ul class="mod_list_falls ng-transclude"></ul>',controller:["$scope","$element","$attrs",function(o,r,i){var a=500;n.setFalls=function(n){var o=e.defer(),i=o.promise;t(function(){var e=r;if(n&&(e=angular.element(document.getElementById(n))),0==e.find("li").length)return void o.reject();var t={x:10,y:10};angular.forEach(e.find("li"),function(e,n){var o,r=e.dataset.x;o=a>r?(document.body.clientWidth-30)/(2*r):(document.body.clientWidth-30)/(2*a),angular.element(e).find("img").eq(0).css({height:e.dataset.y*o+"px"});var i=e.offsetHeight;t.x<=t.y?(e.style.cssText="left:0;top:"+t.x+"px",t.x=t.x+10+i):(e.style.cssText="right:0;top:"+t.y+"px",t.y=t.y+10+i),angular.element(e).addClass("active")}),t.x<=t.y?e.css("height",t.y+"px"):e.css("height",t.x+"px"),o.resolve(e)},0),i.then(function(e){},function(e){},function(e){})}}]}}]),angular.module("phoneApp").directive("footerBar",["$state","cachePool","ENV",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"common/directives/footer_bar.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,t,n,o,r,i){i.ajaxRequest({scope:e,url:"getMsgNews",isAckError:!1,showError:!1,data:{},success:function(t){e.msgStatus={isPraise:t.isPraise,isComment:t.isComment,isNotice:t.isNotice,isTalk:t.isTalk},(t.isPraise||t.isComment||t.isNotice||t.isTalk)&&(e.isMessage=!0)}})}]}}]),angular.module("phoneApp").directive("headerBar",["$window",function(e){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_bar.html",link:function(e,t,n){e.Page||(e.Page={}),e.Page.Title=e.Page.Title||n.title||"",e.Page.RightText=e.Page.RightText||(n.right?n.right.split("|")[0]:""),e.Page.RightFun=e.Page.RightFun||(n.right?e.$eval(n.right.split("|")[1]):"")}}}]).directive("headerOpacity",["$ionicScrollDelegate",function(e){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_opacity.html",controller:["$scope","$element",function(t,n){t.headerScroll=function(){var t=e.$getByHandle("mainScroll").getScrollPosition().top,o=0;o=t>30?((t-30)/100).toFixed(1):0,o>.9&&(o=.9),n.find("ul").eq(1).css({opacity:o})}}]}}]).directive("headerOpacitydetail",["$ionicScrollDelegate",function(e){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_opacity_detail.html",controller:["$scope","$element","$attrs",function(t,n,o){t.RightFun=t.$eval(o.right)||function(){},t.headerScroll=function(){var t=e.$getByHandle("mainScroll").getScrollPosition().top,o=0;o=t>30?((t-30)/100).toFixed(1):0,o>.9&&(o=.9),n.find("ul").eq(1).css({opacity:o})},t.hideScroll=function(){angular.element(document.querySelector(".isscroll"))[0].style.overflowY="hidden"},t.showScroll=function(){angular.element(document.querySelector(".isscroll"))[0].style.overflowY="scroll"},t.showLayout=function(){t.isShowLayout=!t.isShowLayout,t.isShowLayout?t.hideScroll():t.showScroll()},t.hideLayout=function(){t.isShowLayout=!1,t.showScroll()}}]}}]).directive("headerOpacityuser",["$ionicScrollDelegate",function(e){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_opacity_user.html",controller:["$scope","$element",function(t,n){t.headerScroll=function(){var t=e.$getByHandle("mainScroll").getScrollPosition().top,o=0;o=t>30?((t-30)/100).toFixed(1):0,o>.9&&(o=.9),n.find("ul").eq(1).css({opacity:o})}}]}}]),angular.module("phoneApp").directive("jobPopup",["$http","$ionicPopup","widget","cachePool",function(e,t,n,o){return{restrict:"A",link:function(e,r,i){o.pull("JobData");e.tmpJob=e.cInput.Job,e.tmpJobName=e.cInput.JobName,e.chooseJob=function(t){var n=angular.element(t.delegationTarget);n.length>0?(e.tmpJob=n.attr("data-id"),e.tmpJobName=n.attr("data-name")):(e.cInput.Job=e.tmpJob,e.cInput.JobName=e.tmpJobName)},r.bind("click",function(){n.getJobList().then(function(n){e.DataList||(e.DataList={}),e.DataList.JobList=n.JobList,e.tmpJob||(e.tmpJob=e.DataList.JobList[0].Id,e.tmpJobName=e.DataList.JobList[0].Name),t.confirm({title:"选择岗位",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:e,templateUrl:"common/directives/job_popup.html"}).then(function(t){t&&(e.chooseJob(!1),e.Page||(e.Page={}),e.Page.isModify=!0)})})})}}}]),angular.module("phoneApp").directive("locationPopup",["$ionicPopup","$http","widget","cachePool",function(e,t,n,o){return{restrict:"A",link:function(o,r,i){o.tmpMid=0,o.tmpSid=0,o.tmpCityId=0,o.chooseLocation=function(e){var t=angular.element(e.delegationTarget),n=t.parent("ul").attr("data-type"),r=t.attr("data-mid"),i=t.attr("data-sid"),a=t.attr("data-mkey"),l=t.attr("data-skey");switch(n){case"main":a=a,l=0,o.tmpCityId=0,o.tmpMid=r;break;case"sub":a=a,l=l,o.tmpSid=i;break;default:return}a&&(o.CitySubList=o.CityList[a].sub),i&&(o.tmpCityId=i)},r.bind("click",function(){t({method:"GET",url:"api/CityData.json",timeout:15e3}).success(function(t){o.CityList=t,o.CitySubList=o.CityList[0].sub,e.confirm({title:"选择位置",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:o,templateUrl:"common/directives/location_popup.html"}).then(function(e){if(e){if(!o.tmpCityId)return void alert(1111);angular.forEach(t,function(e){203==e.id&&(find=!0,cityName=e.name),find||angular.forEach(e.sub,function(t){203==t.id&&(cityName=e.name+" "+t.name)})}),o.Page||(o.Page={}),o.Page.isModify=!0}})}).error(function(e){n.msgToast("请检查你的网络！")})})}}}]),angular.module("phoneApp").directive("noNetwork",["$state","$stateParams",function(e,t){return{restrict:"E",templateUrl:"scripts/phoneApp/components/no-network/no-network.html",controller:["$scope",function(n){n.refreshPage=function(){var n=e.current,o=angular.copy(t);e.transitionTo(n,o,{reload:!0,inherit:!0,notify:!0})}}]}}]),angular.module("phoneApp").directive("noResults",["$state","$stateParams",function(e,t){return{restrict:"AE",templateUrl:"scripts/phoneApp/components/no-results/no-results.html",link:function(e,t,n){e.noResultsText=n.text?n.text:"抱歉，查询无结果",n.glass&&(e.hasGlass=!0)}}}]),angular.module("phoneApp").directive("pageSheet",["$state","$window","$timeout","$ionicLoading","$ionicBackdrop","$ionicViewSwitcher","$cordovaActionSheet","cachePool","widget","ENV",function(e,t,n,o,r,i,a,l,c,s){return{restrict:"E",replace:!0,templateUrl:"common/directives/page_sheet.html",controller:["$scope","$element","$rootScope","$compile",function(e,t,o,r){function i(t){e.Deploy.isUpload=!0;var o=angular.element(document.querySelector("#tmp"))[0],r=o.getContext("2d"),i=new Image;i.onload=function(){EXIF.getData(i,function(){var t=EXIF.pretty(this),a=t?t.Orientation:1;r.drawImage(i,0,0);var l=new MegaPixImage(i);l.render(o,{maxWidth:640,orientation:a},function(){var t=o.toDataURL("image/jpeg");n(function(){e.Deploy.isUpload=!1,e.Deploy.currentImage=t},2e3),e.hideSheet()})})},i.src=t}function l(e){c.msgToast("获取图片失败！")}e.hideSheet=function(){t.addClass("this_hide"),n(function(){t.removeClass("this_show"),t.removeClass("this_hide"),t.css("display","none")},210)},e.showSheet=function(){var e={buttonLabels:["拍照","照片图库"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0,winphoneEnableCancelButton:!0};document.addEventListener("deviceready",function(){a.show(e).then(function(e){switch(e){case 1:window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA});break;case 2:window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})}})},!1)},e.toSheet=function(t){var n=angular.element(t.delegationTarget),o=n.attr("data-type");switch(o){case"photo":window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case"camera":window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA});break;default:e.hideSheet()}}}]}}]),angular.module("phoneApp").directive("pageBack",["$state","$window","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher","widget",function(e,t,n,o,r,i,a){return{restrict:"A",link:function(e,t,n){t.on("click",function(){a.toBack()})}}}]).directive("pageJump",["$window","$state","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher","widget",function(e,t,n,o,r,i,a){return{restrict:"A",link:function(e,n,o){n.on("click",function(n){var r="forward";if("none"==o.pageJump&&(r="none",e.loadMore={},a.clearView()),"login"==o.pageJump&&!e.UserInfo.UserId)return void e.showLogin();var l=o.router,c=o.options?e.$eval(o.options):{};i.nextDirection(r),t.go(l,c,{inherit:!1})})}}}]),angular.module("phoneApp").directive("searchHeader",["$state","$ionicViewSwitcher","widget","cachePool",function(e,t,n,o){return{restrict:"E",replace:!0,templateUrl:"common/directives/search_header.html",link:function(r,i,a){r.keyword="",r.toSearch=function(){if(r.keyword){var i=o.pull("Keyword")||[];angular.forEach(i,function(e,t){r.keyword==e&&i.splice(t,1)}),i.splice(0,0,r.keyword),o.push("Keyword",i),t.nextDirection("forward"),e.go("forum.search-result",{keyword:encodeURIComponent(r.keyword)})}else e.is("forum.search")?n.msgToast("请输入关键字！"):(t.nextDirection("forward"),e.go("forum.search"))}}}}]),angular.module("phoneApp").directive("shareCtrl",function(){return{restrict:"A",link:function(e,t){t.on("focus blur",function(e){var t=angular.element(e.path[1]);"focus"===e.type?t.addClass("focus"):t.removeClass("focus")})}}}),angular.module("phoneApp").directive("touchMove",["$parse",function(e){return{restrict:"A",compile:function(t,n){var o=e(n.touchMove);return function(e,t){t.on("touchstart",function(t){e.$apply(function(){o(e,{$event:t,$target:t.target})})}),t.on("touchmove",function(t){var n=t.touches[0],r=document.elementFromPoint(n.clientX,n.clientY);e.$apply(function(){o(e,{$event:t,$target:r})}),t.preventDefault()})}}}}]),angular.module("phoneApp").directive("userLogin",["$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(e,t,n,o,r,i){return{restrict:"E",replace:!0,templateUrl:"common/directives/user_login.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,t,n,o,r,i){e.tInput={},e.closeLogin=function(){t.removeClass("this_show")},e.showLogin=function(){t.css("display","block");r(function(){t.addClass("this_show")},50)},e.toLogin=function(){return e.tInput.phone?/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e.tInput.phone)?e.tInput.password?e.tInput.password.length<=5?void i.msgToast("新密码必须大于或等于6位"):void i.ajaxRequest({url:"getLogin",msgError:"登录失败",data:{Phone:e.tInput.phone,Password:md5(e.tInput.password)},success:function(n){return n.UserId?(i.setLogin(n),e.closeLogin(),void r(function(){t.css("display","none")},300)):void i.msgToast("登录失败")},error:function(){i.msgToast("登录失败")}}):void i.msgToast("请输入密码"):void i.msgToast("手机号格式不合法"):void i.msgToast("请输入手机号")}}]}}]).directive("pageLogin",["$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(e,t,n,o,r,i){return{restrict:"E",replace:!0,templateUrl:"common/directives/user_login_page.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,t,n,o,r,i){e.tInput={},e.closeLogin=function(){t.removeClass("this_show")},e.showLogin=function(){t.css("display","block");r(function(){t.addClass("this_show")},50)},e.toLogin=function(){return e.tInput.phone?/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e.tInput.phone)?e.tInput.password?e.tInput.password.length<=5?void i.msgToast("新密码必须大于或等于6位"):void i.ajaxRequest({url:"getLogin",msgError:"登录失败",data:{Phone:e.tInput.phone,Password:md5(e.tInput.password)},success:function(n){return n.UserId?(i.setLogin(n),e.closeLogin(),void r(function(){t.css("display","none")},300)):void i.msgToast("登录失败")},error:function(){i.msgToast("登录失败")}}):void i.msgToast("请输入密码"):void i.msgToast("手机号格式不合法"):void i.msgToast("请输入手机号")}}]}}]),angular.module("phoneApp").directive("getVcode",["$rootScope","$timeout","widget",function(e,t,n){return{restrict:"A",link:function(o,r,i){function a(){e.vEnable=!0,e.vTimer=t(function(){return e.vColdDown--,e.vColdDown<=0?(e.vEnable=!1,void(e.vBtnText="重新发送验证码")):(e.vBtnText="重新发送("+e.vColdDown+")",void a())},1e3)}e.vEnable?(t.cancel(e.vTimer),a()):(e.vColdDown=0,e.vBtnText="发送验证码"),r.bind("click",function(t){if(!o.cInput||!o.cInput.Phone)return void n.msgToast("请输入手机号");var i=n.checkPhone(o.cInput.Phone);if(!i&&0===e.vColdDown){e.vColdDown=60,e.vBtnText="重新发送("+e.vColdDown+")",a();var l=r.attr("data-type")||1;n.ajaxRequest({url:"setSendPhone",data:{Phone:o.cInput.Phone,Type:l},success:function(e){n.msgToast("验证码已发送到"+o.cInput.Phone+"手机上")}})}})}}}]);